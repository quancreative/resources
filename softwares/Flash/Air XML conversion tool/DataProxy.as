package {	import gs.TweenMax;	import flash.filesystem.*;	import pdh.events.*;	import pdh.text.*;	import pdh.util.CSSLoader;		import flash.display.Loader;	import flash.display.MovieClip;	import flash.events.Event;	import flash.net.URLRequest;	import flash.system.ApplicationDomain;	import flash.system.LoaderContext;	public class DataProxy extends MovieClip    {				private var appData				:AppData;		private var appData2			:ExhibitionData;						var archiveurl = "archive_excel_conversion.xml";		var exhibitionurl = "exhibition_excel_conversion.xml";						public function DataProxy ()         {						loadArchive()		}						// ********************************************************************** XML Data										private function loadArchive():void 		{			appData =  new AppData(archiveurl);			appData.addEventListener(AppData.LOADED, handleArchiveLoaded);								}						// config file contains location of data source and search filters to display		private function handleArchiveLoaded(e:Event):void 		{			trace("**********************************");			trace(this + " archive loaded");						trace("**********************************");									generateArchive(appData.rowdata);						//loadExhibition()					}				private function loadExhibition():void 		{			appData2 =  new ExhibitionData(exhibitionurl);			appData2.addEventListener(AppData.LOADED, handleArchiveLoaded);								}						// config file contains location of data source and search filters to display		private function handleExhibitionLoaded(e:Event):void 		{			trace("**********************************");			trace(this + " archive loaded");						trace("**********************************");									generateExhibition(appData2.rowdata);					}									// ----------------------------------------------------------------------------------------------------		//--------------------------------------------------------------------------------------------------------		function generateArchive(dat:Vector.<ArchiveObject>):void 		{						var supertext:String = '<?xml version="1.0" encoding="UTF-8"?>\n';			supertext +='<!DOCTYPE archive SYSTEM "http://www.thamtech.com/dtds/usdc-archive.dtd">';			supertext +='<archive>\n'						for each (var chunk : ArchiveObject in dat) {								supertext+='<item id="'+ chunk.id +'" filename="'+chunk.filename+'">\n';				supertext+='<title><![CDATA[<strong>'+chunk.title+'</strong>, '+chunk.date+']]></title>';				supertext+= '<description>\n';				supertext+= '<![CDATA[\n';				supertext+= chunk.description;				supertext+= ']]>\n';				supertext+= '</description>\n';								supertext+='<transcript>\n<![CDATA[';				supertext+=chunk.transcript;				supertext+=']]></transcript>\n';								supertext+= '<asset-details>\n';				supertext+= '<![CDATA[\n';				supertext+= chunk.asset_details;				supertext+= ']]>\n';				supertext+= '</asset-details>\n';								supertext+= '<exhibitions>\n';				supertext+= '<exhibition ref="'+chunk.exhibitions+ ' " />\n';				supertext+= '</exhibitions>\n';								supertext+= '<types>\n';				supertext+= '<type ref="'+chunk.types+'"/>\n';								supertext+= '</types>\n';				supertext+= '</item>\n';				supertext+='\n';							}						supertext +='</archive>';						writeFile("archive.xml", supertext);								}								// ----------------------------------------------------------------------------------------------------		//--------------------------------------------------------------------------------------------------------				function generateExhibition(dat:Vector.<ExhibitionObject>):void 		{						var supertext:String = '<?xml version="1.0" encoding="UTF-8"?>\n';			supertext +='<exhibitions>\n'						for each (var chunk : ExhibitionObject in dat) {							// parse exhibition itemss							supertext +='<exhibition id="in-the-cold-war">';					supertext +='<title><![CDATA[<strong>"We were very much in the Cold War..."</strong> - Karl Mautner]]></title>';					supertext +='<introduction>';					supertext +='<![CDATA[';										supertext +=']]>';					supertext +='</introduction>';										supertext +='<subtopic>';					supertext +='<title>Berlin Divided and Isolated</title>';					supertext +='<body>';					supertext +='</body>';					supertext +='<related-items>';					supertext +='<related-item ref="printing-block"/>';					supertext +='<related-item ref="printing-block-2"/>';					supertext +='</related-items>';					supertext +='</subtopic>';					supertext +='</subtopics>';					supertext +='</exhibition>';							}						supertext +='</exhibitions>'						writeFile("exhibition.xml", supertext);								}								// ----- FILE WRITING										private function writeFile(filename:String, data:String):void 		{			var bad1:String = '<text:p xmlns:office="http://openoffice.org/2000/office" xmlns:style="http://openoffice.org/2000/style" xmlns:text="http://openoffice.org/2000/text" xmlns:table="http://openoffice.org/2000/table" xmlns:draw="http://openoffice.org/2000/drawing" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="http://openoffice.org/2000/meta" xmlns:number="http://openoffice.org/2000/datastyle" xmlns:presentation="http://openoffice.org/2000/presentation" xmlns:svg="http://www.w3.org/2000/svg" xmlns:chart="http://openoffice.org/2000/chart" xmlns:dr3d="http://openoffice.org/2000/dr3d" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="http://openoffice.org/2000/form" xmlns:script="http://openoffice.org/2000/script" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:rdfa="http://docs.oasis-open.org/opendocument/meta/rdfa#" xmlns:field="urn:opennames:experimental:ooo-ms-interop:xmlns:field:1.0"/>';			var bad2:String = '<text:p xmlns:office="http://openoffice.org/2000/office" xmlns:style="http://openoffice.org/2000/style" xmlns:text="http://openoffice.org/2000/text" xmlns:table="http://openoffice.org/2000/table" xmlns:draw="http://openoffice.org/2000/drawing" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="http://openoffice.org/2000/meta" xmlns:number="http://openoffice.org/2000/datastyle" xmlns:presentation="http://openoffice.org/2000/presentation" xmlns:svg="http://www.w3.org/2000/svg" xmlns:chart="http://openoffice.org/2000/chart" xmlns:dr3d="http://openoffice.org/2000/dr3d" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="http://openoffice.org/2000/form" xmlns:script="http://openoffice.org/2000/script" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:rdfa="http://docs.oasis-open.org/opendocument/meta/rdfa#" xmlns:field="urn:opennames:experimental:ooo-ms-interop:xmlns:field:1.0">';			var bad3:String = '<text:p xmlns:office="http://openoffice.org/2000/office" xmlns:style="http://openoffice.org/2000/style" xmlns:text="http://openoffice.org/2000/text" xmlns:table="http://openoffice.org/2000/table" xmlns:draw="http://openoffice.org/2000/drawing" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="http://openoffice.org/2000/meta" xmlns:number="http://openoffice.org/2000/datastyle" xmlns:presentation="http://openoffice.org/2000/presentation" xmlns:svg="http://www.w3.org/2000/svg" xmlns:chart="http://openoffice.org/2000/chart" xmlns:dr3d="http://openoffice.org/2000/dr3d" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="http://openoffice.org/2000/form" xmlns:script="http://openoffice.org/2000/script" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:rdfa="http://docs.oasis-open.org/opendocument/meta/rdfa#" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0">'						var bad4:String = '<text:p xmlns:office="http://openoffice.org/2000/office" xmlns:style="http://openoffice.org/2000/style" xmlns:text="http://openoffice.org/2000/text" xmlns:table="http://openoffice.org/2000/table" xmlns:draw="http://openoffice.org/2000/drawing" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="http://openoffice.org/2000/meta" xmlns:number="http://openoffice.org/2000/datastyle" xmlns:presentation="http://openoffice.org/2000/presentation" xmlns:svg="http://www.w3.org/2000/svg" xmlns:chart="http://openoffice.org/2000/chart" xmlns:dr3d="http://openoffice.org/2000/dr3d" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="http://openoffice.org/2000/form" xmlns:script="http://openoffice.org/2000/script" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:rdfa="http://docs.oasis-open.org/opendocument/meta/rdfa#" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0"/>"/>';						var bad5:String = '<text:p xmlns:office="http://openoffice.org/2000/office" xmlns:style="http://openoffice.org/2000/style" xmlns:text="http://openoffice.org/2000/text" xmlns:table="http://openoffice.org/2000/table" xmlns:draw="http://openoffice.org/2000/drawing" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="http://openoffice.org/2000/meta" xmlns:number="http://openoffice.org/2000/datastyle" xmlns:presentation="http://openoffice.org/2000/presentation" xmlns:svg="http://www.w3.org/2000/svg" xmlns:chart="http://openoffice.org/2000/chart" xmlns:dr3d="http://openoffice.org/2000/dr3d" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="http://openoffice.org/2000/form" xmlns:script="http://openoffice.org/2000/script" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:rdfa="http://docs.oasis-open.org/opendocument/meta/rdfa#" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0"/>'			var bad6:String = '<text:p xmlns:office="http://openoffice.org/2000/office" xmlns:style="http://openoffice.org/2000/style" xmlns:text="http://openoffice.org/2000/text" xmlns:table="http://openoffice.org/2000/table" xmlns:draw="http://openoffice.org/2000/drawing" xmlns:fo="http://www.w3.org/1999/XSL/Format" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:meta="http://openoffice.org/2000/meta" xmlns:number="http://openoffice.org/2000/datastyle" xmlns:presentation="http://openoffice.org/2000/presentation" xmlns:svg="http://www.w3.org/2000/svg" xmlns:chart="http://openoffice.org/2000/chart" xmlns:dr3d="http://openoffice.org/2000/dr3d" xmlns:math="http://www.w3.org/1998/Math/MathML" xmlns:form="http://openoffice.org/2000/form" xmlns:script="http://openoffice.org/2000/script" xmlns:ooo="http://openoffice.org/2004/office" xmlns:ooow="http://openoffice.org/2004/writer" xmlns:oooc="http://openoffice.org/2004/calc" xmlns:dom="http://www.w3.org/2001/xml-events" xmlns:xforms="http://www.w3.org/2002/xforms" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:rpt="http://openoffice.org/2005/report" xmlns:of="urn:oasis:names:tc:opendocument:xmlns:of:1.2" xmlns:rdfa="http://docs.oasis-open.org/opendocument/meta/rdfa#" xmlns:field="urn:openoffice:names:experimental:ooo-ms-interop:xmlns:field:1.0"/>';						data = removeCrap(data, bad1);			data = removeCrap(data, bad2);			data = removeCrap(data, bad3);			data = removeCrap(data, bad4);			data = removeCrap(data, bad5);			data = removeCrap(data, bad6);			data = removeCrap(data, "<text:p>");			data = removeCrap(data, "</text:p>");			data = removeCrap(data, "<text:s/>", "<br/><br/>");			data = removeCrap(data, '<text:s text:c="2"/>', "<br/><br/>");			data = removeCrap(data, '<text:s text:c="51"/>', "<br/><br/>");			data = removeCrap(data, '<text:s text:c="91"/>', "<br/><br/>");			data = removeCrap(data, '<text:s text:c="91"/>', "<br/><br/>");			data = removeCrap(data, '<text:s text:c="78"/>', "<br/><br/>");									var fileOpened:File = File.desktopDirectory.resolvePath(filename);			var fs:FileStream = new FileStream();			fs.open(fileOpened, FileMode.WRITE);			fs.writeUTFBytes(data);			fs.close();		}				private function removeCrap($str:String, targets:String, replaceStr:String = ""):String		{			var $search:String = targets; 			var $replace:String = replaceStr;			var str2:String = $str.split($search).join($replace); 			return str2;		}						} // end class} // end function